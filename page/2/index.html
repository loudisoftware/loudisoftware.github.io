<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico.svg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico.svg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="学而不思则罔思而不学则殆">
<meta property="og:type" content="website">
<meta property="og:title" content="WJAINNG">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="WJAINNG">
<meta property="og:description" content="学而不思则罔思而不学则殆">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="wjainng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>WJAINNG</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">WJAINNG</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/29/2020-07-29-%E5%B8%B8%E7%94%A8SQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mountain.jpg">
      <meta itemprop="name" content="wjainng">
      <meta itemprop="description" content="学而不思则罔思而不学则殆">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WJAINNG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/29/2020-07-29-%E5%B8%B8%E7%94%A8SQL/" class="post-title-link" itemprop="url">常用SQL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-29 22:33:31" itemprop="dateCreated datePublished" datetime="2020-07-29T22:33:31+08:00">2020-07-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-16 23:15:44" itemprop="dateModified" datetime="2020-09-16T23:15:44+08:00">2020-09-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="强制走索引force-index"><a href="#强制走索引force-index" class="headerlink" title="强制走索引force index"></a>强制走索引force index</h3><ol>
<li>ignore index 忽略特点的索引</li>
<li>use index 只参考特点的索引</li>
<li>force index 强制使用特点的索引</li>
</ol>
<blockquote>
<p>delete指定force index 时需要指定表两次，例如 delete tablea from tablea force index(<code>index_name</code>) where condition; update tablea force index(<code>index_name</code>) set columna = *** where condition;</p>
</blockquote>
<h3 id="查看trace"><a href="#查看trace" class="headerlink" title="查看trace"></a>查看trace</h3><p>SHOW VARIABLES LIKE ‘%optimizer_trace%’;<br>SET optimizer_trace=”enabled=on”;<br>delete sales from sales  where sales.sale_date = ‘2020-05-04’;<br>SELECT * FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;<br>SET optimizer_trace=”enabled=off”;<br>通过查看trace文件可以分析优化器为啥选择相应的执行计划</p>
<h3 id="查看引擎状态"><a href="#查看引擎状态" class="headerlink" title="查看引擎状态"></a>查看引擎状态</h3><p>show engine innodb status;老版本为show innodb status;</p>
<h3 id="事务相关设置"><a href="#事务相关设置" class="headerlink" title="事务相关设置"></a>事务相关设置</h3><h4 id="设置事务隔离级别"><a href="#设置事务隔离级别" class="headerlink" title="设置事务隔离级别"></a>设置事务隔离级别</h4><p>set session transaction isolation level read uncommitted | read committed | repeatable read |  serializable;</p>
<h4 id="查看事务的隔离级别"><a href="#查看事务的隔离级别" class="headerlink" title="查看事务的隔离级别"></a>查看事务的隔离级别</h4><p>select @@tx_isolation;</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/26/2020-07-26-mysql-%E9%94%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mountain.jpg">
      <meta itemprop="name" content="wjainng">
      <meta itemprop="description" content="学而不思则罔思而不学则殆">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WJAINNG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/26/2020-07-26-mysql-%E9%94%81/" class="post-title-link" itemprop="url">mysql-锁</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-26 22:36:19" itemprop="dateCreated datePublished" datetime="2020-07-26T22:36:19+08:00">2020-07-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-16 23:15:44" itemprop="dateModified" datetime="2020-09-16T23:15:44+08:00">2020-09-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="表锁与行锁"><a href="#表锁与行锁" class="headerlink" title="表锁与行锁"></a>表锁与行锁</h3><h4 id="表锁"><a href="#表锁" class="headerlink" title="表锁"></a>表锁</h4><p>表锁主要有IS，IX，S，X，四种。其中IS，IX为意向锁，意向锁是兼容的也就是可以在同一个表中加多个IX锁。在为记录加S和X锁时会在对应的表上加IS和IX锁。</p>
<p>表锁的兼容性为：</p>
<table>
<thead>
<tr>
<th></th>
<th>IS</th>
<th>IX</th>
<th>S</th>
<th>X</th>
</tr>
</thead>
<tbody><tr>
<td>IS</td>
<td>兼容</td>
<td>兼容</td>
<td>兼容</td>
<td>不兼容</td>
</tr>
<tr>
<td>IX</td>
<td>兼容</td>
<td>兼容</td>
<td>不兼容</td>
<td>不兼容</td>
</tr>
<tr>
<td>S</td>
<td>兼容</td>
<td>不兼容</td>
<td>兼容</td>
<td>不兼容</td>
</tr>
<tr>
<td>X</td>
<td>不兼容</td>
<td>不兼容</td>
<td>不兼容</td>
<td>不兼容</td>
</tr>
</tbody></table>
<p>AUTO-INC锁，当使用自增长列时，在插入数据时不知道会插入多少条数据时使用。这个时候插入语句会阻塞。（例如两个会话都执行insert tablea select * from tablea 时有一个会阻塞）</p>
<h4 id="行锁"><a href="#行锁" class="headerlink" title="行锁"></a>行锁</h4><ol>
<li>Record Locks： 记录锁，只会锁住记录本身。</li>
<li>Gap Locks：间隙锁，锁住该记录之前的间隙。</li>
<li>Next-Key Locks：锁住记录本身和记录前的间隙，相当于记录锁+间隙锁。</li>
<li>Insert Intention Locks：插入意向锁，插入数据时如果对应的间隙被锁住则需要等待。</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2020/svg/2006869/1598774840470-5b1a48fc-1379-4b52-a93b-08efd7d13443.svg"> </p>
<blockquote>
<p>mysql中每一个页都会有一个代表该页的最小和最大的两条记录，通过在最大记录上加上间隙锁代表记录35到+∞都是被锁住的。</p>
</blockquote>
<h3 id="读未提交-读已提交"><a href="#读未提交-读已提交" class="headerlink" title="读未提交|读已提交"></a>读未提交|读已提交</h3><h4 id="主键精确查询"><a href="#主键精确查询" class="headerlink" title="主键精确查询"></a>主键精确查询</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="keyword">key</span> = xxx [<span class="keyword">for</span> <span class="keyword">update</span>|<span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span>]</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">table</span> <span class="keyword">set</span> <span class="keyword">column</span> = xxx <span class="keyword">where</span> <span class="keyword">key</span> = xxx</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="keyword">key</span> = xxx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>select语句可以指定加锁的类型是X锁还是S锁，update和delete都是加X锁。</p>
</blockquote>
<p>select/update/delete 都会对指定主键的记录加对应的锁。update如果更新到了二级索引则还会在更新到的二级索引中主键值为key的记录加X锁。delete则会给所有的二级索引中主键值对key的记录加X锁。（相当于所有的二级索引都需要进行更新）</p>
<h4 id="主键范围查询"><a href="#主键范围查询" class="headerlink" title="主键范围查询"></a>主键范围查询</h4><p>主键范围查询与主键精确查询类似，只是会对第一个不满足条件的主键记录会<em>先加锁然后再释放</em>。</p>
<h4 id="二级索引精确查询"><a href="#二级索引精确查询" class="headerlink" title="二级索引精确查询"></a>二级索引精确查询</h4><p>先对二级索引对应的记录加锁，然后再对二级索引找到的记录对应的主键记录加索引。（先二级索引记录再主键索引记录）</p>
<h4 id="二级索引范围查询"><a href="#二级索引范围查询" class="headerlink" title="二级索引范围查询"></a>二级索引范围查询</h4><p>同二级索引精确查询，只是在ICP的情况下，还是会锁住不满足要求的二级索引边界值。（并不会释放，主键范围时是先加锁然后释放）</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>间隙锁是用来解决幻读的，因为读未提交和读已提交都不能避免幻读，因此在这两种隔离级别中不会出现间隙锁，因此也不会出现next-key lock以及插入意向锁，只会存在记录锁。根据实际查找数据的顺序进行加锁，例如根据二级索引查找时会先对二级索引记录加锁，再对主键记录加锁，反之也一样。另外需要注意在<em>范围查询时</em>对不满足要求的<em>边界记录</em>会<em>先加锁然后再释放锁</em>的情况。（<em>在5.6版本测试过程中发现范围查询时select语句会锁不满足的边界记录但是update和delete语句不会</em>）。insert一般不会加锁，当插入数据导致违法唯一约束时会加S锁，在update *** where id in (select id from b)时会对b表加上S锁。</p>
<p><em>只有二级索引才会使用ICP，并且使用ICP时select语句会锁不满足条件的边界值并且不会释放锁，updae不会加锁也就不存在释放</em></p>
<blockquote>
<p>索引下推(index condition pushdown)，当存储引擎获取数据时如果能够根据索引对应的字段进行过滤则不会把数据返回到server层，直接在返回数据之前进行过滤。返回server层的数据再对没有下推的条件进行过滤，可以减少返回server层的数据。（当全部使用ICP时查询计划中只会有index condition pushdown，当有server层的过滤时会显示using where）</p>
</blockquote>
<h3 id="可重复读"><a href="#可重复读" class="headerlink" title="可重复读"></a>可重复读</h3><p>mysql的可重复读通过间隙锁解决幻读的问题。</p>
<h4 id="主键精确查询-1"><a href="#主键精确查询-1" class="headerlink" title="主键精确查询"></a>主键精确查询</h4><ol>
<li>select * from table where primaryKey = *** lock in share mode。<br>当查询的记录存在时，锁定对应的记录(record lock)，因为不会有其他事务插入和主键相同的数据，所以不需要间隙锁，因此和读已提交情况的加锁一致。<br>当查询的记录不存在时，需要锁定该记录所在的间隙(gap lock)，避免在该间隙中插入与查询条件相同的主键数据。</li>
<li>update/delete语句与读已提交情况一致。（某种程度上说明不能解决幻读，例如在事务的中间另外一个事务更新了某条数据导致后续的update的where条件满足）</li>
</ol>
<h4 id="主键范围查询-1"><a href="#主键范围查询-1" class="headerlink" title="主键范围查询"></a>主键范围查询</h4><p>以select * from tableA where key betwwen left and right for update为例：</p>
<ol>
<li>left的加锁情况：如果left的值存在则加record lock，否则则在满足条件的第一条记录上加next-key lock。</li>
<li>right的加锁情况：会找到第一条不满足条件的记录加next-key lock。</li>
<li>left和right之间的记录全部加next-key lock。</li>
</ol>
<p>update/insert与select类似，只是在更新了二级索引字段时会在二级索引对应的记录加record lock。</p>
<h4 id="二级索引精确查询-1"><a href="#二级索引精确查询-1" class="headerlink" title="二级索引精确查询"></a>二级索引精确查询</h4><h5 id="唯一二级索引"><a href="#唯一二级索引" class="headerlink" title="唯一二级索引"></a>唯一二级索引</h5><p>效果与主键精确查询一样，只是会锁住二级索引的同时还会锁住主键索引(都是record lock)。（如果没有找到记录则只会给二级索引加一个间隙锁。）</p>
<h5 id="非唯一二级索引"><a href="#非唯一二级索引" class="headerlink" title="非唯一二级索引"></a>非唯一二级索引</h5><p>理论上非唯一二级索引不存在精确查找。</p>
<p>以select * from tableA where b = ‘sencod unique index’ for update 为例：<br>因为b是非唯一二级索引相当于有很多满足条件的数据，避免在之前，之后，之中插入数据，需要对第一条满足条件的数据到第一条不满足条件的数据全部加next-key lock。</p>
<h4 id="二级索引范围查询-1"><a href="#二级索引范围查询-1" class="headerlink" title="二级索引范围查询"></a>二级索引范围查询</h4><h5 id="唯一二级索引-1"><a href="#唯一二级索引-1" class="headerlink" title="唯一二级索引"></a>唯一二级索引</h5><p>同主键范围查询<em>区别点在于都是加next-key lock</em>而主键范围对左边条件满足时只会加record lock。</p>
<h5 id="非唯一二级索引-1"><a href="#非唯一二级索引-1" class="headerlink" title="非唯一二级索引"></a>非唯一二级索引</h5><p>同唯一二级索引范围查询</p>
<h4 id="全表扫描"><a href="#全表扫描" class="headerlink" title="全表扫描"></a>全表扫描</h4><p>全部加next-key lock。</p>
<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><p>repetable下为了避免幻读，需要增加gap锁，因此一般都是加的next-key lock。只有主键或者唯一索引查找时可能加recod lock或者gap锁。范围查找时也需要对第一个不满足条件的数据加next-key lock并且不会释放。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/25/2020-07-25-myql-%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mountain.jpg">
      <meta itemprop="name" content="wjainng">
      <meta itemprop="description" content="学而不思则罔思而不学则殆">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WJAINNG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/25/2020-07-25-myql-%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">myql-基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-25 20:37:41" itemprop="dateCreated datePublished" datetime="2020-07-25T20:37:41+08:00">2020-07-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-16 23:15:44" itemprop="dateModified" datetime="2020-09-16T23:15:44+08:00">2020-09-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h3><ol>
<li>字符集指的是某个字符范围的编码规则。</li>
<li>比较规则是针对某个字符集中的字符比较大小的一种规则。</li>
<li>mysql中，一个字符集可以有若干中比较规则，有一个默认的比较规则。</li>
<li>查看mysql中支持的字符集和比较规则的语句如下：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> (<span class="built_in">character</span> <span class="keyword">set</span>|<span class="keyword">charset</span>) [<span class="keyword">like</span> 模式];</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">collation</span> [<span class="keyword">like</span> 模式];</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>mysql有四个级别的字符集和比较规则：<ul>
<li>服务器级别：由charset_set_server,collation_server表示字符和比较规则。</li>
<li>数据库级别：创建和修改数据库时可以指定字符集和比较规则，如果不指定默认为服务器级别的值。</li>
<li>表级别：创建和修改表时指定。</li>
<li>字段级别：创建和修改列定义时指定。</li>
</ul>
</li>
<li>发送请求到接收结果过程中发生的字符集转换。</li>
</ol>
<table>
<thead>
<tr>
<th>系统变量</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>character_set_client</td>
<td>服务器解码请求时用到的字符集</td>
</tr>
<tr>
<td>character_set_connection</td>
<td>处理请求时会把请求字符串从character_set_client转换为character_set_connection</td>
</tr>
<tr>
<td>character_set_result</td>
<td>服务器向客户端返回数据时的字符集</td>
</tr>
</tbody></table>
<blockquote>
<p>一般情况下要保持这三个变量的值和客户端的字符集一致。</p>
</blockquote>
<ol start="7">
<li>比较规则的作用通常用来进行字符串大小的表达式，以及排序中。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/06/14/2020-06-14-JMM%E4%B8%8E%E9%94%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mountain.jpg">
      <meta itemprop="name" content="wjainng">
      <meta itemprop="description" content="学而不思则罔思而不学则殆">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WJAINNG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/14/2020-06-14-JMM%E4%B8%8E%E9%94%81/" class="post-title-link" itemprop="url">JMM与锁</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-14 21:42:36" itemprop="dateCreated datePublished" datetime="2020-06-14T21:42:36+08:00">2020-06-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-08 23:26:16" itemprop="dateModified" datetime="2020-11-08T23:26:16+08:00">2020-11-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h3><p>jdk1.5之后除了synchronized关键字还可以使用lock来进行线程的同步。Lock给使用者更多的选择，并且能支持公平和非公平的锁，获取不到锁时允许中断，超时获取锁等。<br>因为synchronized关键字是非显示的申明获取锁因此又称为隐式锁，synchronized可以用在代码块和方法上，当用在方法上时通过标记ACC_SYNCHRONIZED实现，用在代码块中通过monitorenter和monitorexit实现（javap查看）。</p>
<p>lock的使用方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">//业务代码</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><small>注意：<em>当使用tryLock时不能使用这种格式，会导致没有获取到锁也去释放锁，应该使用以下的方式</em></small></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(lock.tryLock()) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//业务代码</span></span><br><span class="line">  &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="Lock方法说明"><a href="#Lock方法说明" class="headerlink" title="Lock方法说明"></a>Lock方法说明</h4><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>void lock()</td>
<td>获取锁，获取不到则等待</td>
</tr>
<tr>
<td>void lockInterruptibly()</td>
<td>获取到锁则返回，否则加入等待队列。如果获取到锁或者被中断则返回</td>
</tr>
<tr>
<td>boolean tryLock()</td>
<td>如果获取锁成功则返回true，获取失败返回false，都会立即返回不会阻塞</td>
</tr>
<tr>
<td>boolean tryLock(time, timeUnit)</td>
<td>如果获取锁成功则返回true。否则会阻塞直到获取锁或者被中断或者阻塞时间到，只有获取到锁时返回true，其他情况返回false</td>
</tr>
<tr>
<td>void unlock()</td>
<td>释放锁</td>
</tr>
<tr>
<td>Condition newCondition()</td>
<td>返回一个绑定到该锁的一个新的条件对象</td>
</tr>
</tbody></table>
<h4 id="同步器AQS-AbstractQueuedSynchronizer"><a href="#同步器AQS-AbstractQueuedSynchronizer" class="headerlink" title="同步器AQS(AbstractQueuedSynchronizer)"></a>同步器AQS(AbstractQueuedSynchronizer)</h4><p>同步器获取和修改状态的方法</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>getState()</td>
<td>获取当前的同步状态</td>
</tr>
<tr>
<td>setState(int newState)</td>
<td>设置当前同步状态</td>
</tr>
<tr>
<td>compareAndSetState(int expect, int update)</td>
<td>使用CAS设置同步状态</td>
</tr>
</tbody></table>
<p>同步器可以重写的方法</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>booelan tryAcquire(int arg)</td>
<td>独占式获取同步状态,获取成功则返回true，否则返回false</td>
</tr>
<tr>
<td>tryRelease(int arg)</td>
<td>独占式释放同步状态，等待获取同步状态的线程有机会获取同步状态</td>
</tr>
<tr>
<td>boolean tryAcquireShared(int arg)</td>
<td>共享式获取同步状态，大于等于0表示获取成功，否则获取失败</td>
</tr>
<tr>
<td>tryReleaseShared(int arg)</td>
<td>共享式释放同步状态</td>
</tr>
<tr>
<td>boolean isHeldExclusively()</td>
<td>表示当前线程是否独占锁</td>
</tr>
</tbody></table>
<p>AQS内部结构：<br><img src="/images/lock-aqs.svg"></p>
<blockquote>
<p>Conditon是锁的内部类，必须获得锁才能调用await和signal方法，condition从await返回可以当做两步理解，第一从等待队列移到同步队列，第二成为同步队列的首节点(获得锁)。</p>
</blockquote>
<h4 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h4><h5 id="线程的实现方式"><a href="#线程的实现方式" class="headerlink" title="线程的实现方式"></a>线程的实现方式</h5><ol>
<li>继承Thread，通过start()启动线程会执行线程的run方法。</li>
<li>实现Runnable，然后把runnable当做线程的参数，通过start()启动线程后会执行runnable的run方法[线程的默认实现run方法为调用target的run方法]。</li>
<li>针对有返回值的情况下实现Callable，然后构造一个FutureTask，把FutrueTask当做线程的参数传入线程，通过start()启动线程后最终会调用到Callable的call()方法。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Callable callable = <span class="keyword">new</span> Callable(()-&gt;<span class="string">&quot;Say Hello&quot;</span>);</span><br><span class="line">FutureTask futureTask = <span class="keyword">new</span> FutureTask(callable);</span><br><span class="line"><span class="keyword">new</span> Thread(futureTask).start();</span><br><span class="line">futureTask.get();<span class="comment">//会返回“Say Hello&quot;</span></span><br></pre></td></tr></table></figure>

<p><small>FutureTask支持取消任务，如果任务能够响应中断还能取消正在运行的任务。submit最终也是调用execute方法，只是传递给execute的为封装为FutureTask的对象</small></p>
<p>java线程的状态及转换：<br><img src="/images/thread-status.svg"></p>
<h5 id="线程池的初始化"><a href="#线程池的初始化" class="headerlink" title="线程池的初始化"></a>线程池的初始化</h5><p>线程池初始化时可以指定核心线程数，最大线程数，线程工厂，阻塞队列，空闲时间，空闲时间参数，拒绝策略。（核心线程也可以通过设置allowCoreThreadTimeOut达到空闲时间进行移除）往线程池增加任务时的流程如下图：</p>
<p><img src="/images/thread-pool-init.svg"></p>
<p>工作线程启动后会调用runWorker方法，在循环中不断从队列中获取任务并执行任务。流程图如下：</p>
<p><img src="/images/thread-pool-run.svg"></p>
<p><small> 通过在获取task时进行工作线程的空闲时间处理，如果超过核心线程数，或者允许核心线程数移除则在获取任务时会设置最长的阻塞时间，如果这段时间还是获取不到任务则返回null，则会导致线程的runWorker方法执行完毕，最终会执行清除线程的方法。</small></p>
<blockquote>
<p>线程池执行的任务一种为runnable，一种为callable，实际是通过工作线程调用runnable和callable接口的方法。工作线程由线程池进行初始化，通过在工作线程池的run方法中执行相应的run和call方法。</p>
</blockquote>
<h5 id="线程池的停止"><a href="#线程池的停止" class="headerlink" title="线程池的停止"></a>线程池的停止</h5><p>和线程池停止相关的方法</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>shuntDown</td>
<td>停止线程池，不再接受新的任务（放入新的任务会执行拒绝策略），已经在队列中的任务还是会执行。</td>
</tr>
<tr>
<td>shuntDownNow</td>
<td>停止线程池，不再接受新的任务（放入新的任务会执行拒绝策略），通过中断处理正在执行的任务。返回在队列中的任务列表。</td>
</tr>
<tr>
<td>awaitTermination</td>
<td>等待线程池停止，返回true表示任务都执行完成，结合shuntDown使用。</td>
</tr>
</tbody></table>
<h3 id="jvm参数"><a href="#jvm参数" class="headerlink" title="jvm参数"></a>jvm参数</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java 输出jvm标准参数</span><br><span class="line">java -X 输出非标准参数（默认jvm实现这些参数的功能，但是并不保证所有jvm实现都满足，且不保证向后兼容）</span><br><span class="line">java -XX:+PrintFlagsFinal 输出非稳定参数（此类参数各个jvm实现会有所不同，将来可能会随时取消，需要慎重使用）</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/06/09/2020-06-09-PPT-%E4%B8%93%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mountain.jpg">
      <meta itemprop="name" content="wjainng">
      <meta itemprop="description" content="学而不思则罔思而不学则殆">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WJAINNG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/09/2020-06-09-PPT-%E4%B8%93%E9%A2%98/" class="post-title-link" itemprop="url">PPT-专题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-09 23:04:45" itemprop="dateCreated datePublished" datetime="2020-06-09T23:04:45+08:00">2020-06-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-16 23:15:44" itemprop="dateModified" datetime="2020-09-16T23:15:44+08:00">2020-09-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="审美观"><a href="#审美观" class="headerlink" title="审美观"></a>审美观</h4><p>从海报、视觉、画册、平面设计、演示中学习，增加自己的审美观。</p>
<h4 id="文字修饰"><a href="#文字修饰" class="headerlink" title="文字修饰"></a>文字修饰</h4><ol>
<li>为文字增加线框</li>
<li>倒影效果 （形状倒影）</li>
<li>镂空效果（合并形状剪除）</li>
<li>三维旋转 (颜色渐变+旋转)</li>
</ol>
<h4 id="形状"><a href="#形状" class="headerlink" title="形状"></a>形状</h4><ol>
<li>合并形状</li>
<li>通过形状画小图标</li>
<li>通过形状分割版面 （开放路径）</li>
<li>版面透明框</li>
<li>强度内容，增加背景形状。</li>
</ol>
<h4 id="配色"><a href="#配色" class="headerlink" title="配色"></a>配色</h4><ol>
<li>颜色太多</li>
<li>取色器获取配色方案</li>
<li>主色调，背景色，字体颜色</li>
<li>通过色调值变化成其他主题的颜色</li>
</ol>
<h4 id="图标优化"><a href="#图标优化" class="headerlink" title="图标优化"></a>图标优化</h4><ol>
<li>增加图标专业度</li>
<li>降低信息量</li>
<li>修饰布局</li>
</ol>
<h4 id="表格修饰"><a href="#表格修饰" class="headerlink" title="表格修饰"></a>表格修饰</h4><ol>
<li>建立主色调</li>
<li>建立边框线</li>
<li>规律性底纹</li>
</ol>
<h4 id="版面设计"><a href="#版面设计" class="headerlink" title="版面设计"></a>版面设计</h4><ol>
<li>对齐</li>
<li>对比（颜色，大小，形状，距离）</li>
<li>亲密性（相关的内容距离更近）</li>
<li>重复（风格统一）</li>
</ol>
<h4 id="页面框架"><a href="#页面框架" class="headerlink" title="页面框架"></a>页面框架</h4><ol>
<li>分割（上下，左右）</li>
<li>分裂（多个区域）</li>
<li>居中（中间放文字）</li>
<li>包围</li>
<li>对称</li>
<li>杂志</li>
</ol>
<h4 id="相关网站"><a href="#相关网站" class="headerlink" title="相关网站"></a>相关网站</h4><p><a target="_blank" rel="noopener" href="http://www.stickpng.org/">http://www.stickpng.org</a><br><a target="_blank" rel="noopener" href="https://huaban.com/">https://huaban.com/</a><br><a target="_blank" rel="noopener" href="http://www.yanj.cn/">http://www.yanj.cn/</a><br><a target="_blank" rel="noopener" href="https://www.zcool.com.cn/">https://www.zcool.com.cn/</a> </p>
<p><a target="_blank" rel="noopener" href="https://www.hellofont.cn/">https://www.hellofont.cn/</a><br><a target="_blank" rel="noopener" href="https://www.iconfont.cn/">https://www.iconfont.cn/</a><br><a target="_blank" rel="noopener" href="http://font.chinaz.com/">http://font.chinaz.com/</a><br><a target="_blank" rel="noopener" href="http://www.qiuziti.com/">http://www.qiuziti.com/</a><br><a target="_blank" rel="noopener" href="https://www.58pic.com/">https://www.58pic.com/</a></p>
<p><a target="_blank" rel="noopener" href="http://www.ppj.io/">http://www.ppj.io/</a></p>
<p><a target="_blank" rel="noopener" href="https://dribbble.com/">https://dribbble.com/</a><br><a target="_blank" rel="noopener" href="http://www.peise.net/">http://www.peise.net/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/06/07/2020-06-07-%E7%BA%BF%E7%A8%8B-%E4%B8%93%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mountain.jpg">
      <meta itemprop="name" content="wjainng">
      <meta itemprop="description" content="学而不思则罔思而不学则殆">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WJAINNG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/07/2020-06-07-%E7%BA%BF%E7%A8%8B-%E4%B8%93%E9%A2%98/" class="post-title-link" itemprop="url">线程-专题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-07 16:03:56" itemprop="dateCreated datePublished" datetime="2020-06-07T16:03:56+08:00">2020-06-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-16 23:15:44" itemprop="dateModified" datetime="2020-09-16T23:15:44+08:00">2020-09-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h3><p>线程为现代操作系统的最少调度单位，也称为轻量级进程。每个线程具有自己的计数器，堆栈和局部变量，且能访问共享的内存变量。<br>java中有两种线程类型，一种普通的，一种为daemon线程，daemon线程主要用来执行一些支持性工作例如Reference Handler，Finalizer，GC线程，当jvm中只存在daemon线程时jvm会退出。<font color='red'><em>daemon线程中的finally方法有可能不会执行</em></font></p>
<ul>
<li>java线程状态流转图<br><img src="/images/thread-status.svg"></li>
</ul>
<h4 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h4><p>为了避免线程的创建及销毁应该尽量使用线程池来达到同样的目的。</p>
<ul>
<li>线程池创建参数说明</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>corePoolSize</td>
<td>核心线程数</td>
</tr>
<tr>
<td>maxmumPoolSize</td>
<td>最大线程数</td>
</tr>
<tr>
<td>threadFactory</td>
<td>线程工厂</td>
</tr>
<tr>
<td>runnableTaskQueue</td>
<td>任务队列</td>
</tr>
<tr>
<td>handler</td>
<td>拒绝策略</td>
</tr>
<tr>
<td>keepAliveTime</td>
<td>空闲线程的最大存活时间</td>
</tr>
<tr>
<td>timeUnit</td>
<td>空闲线程的最大存活时间</td>
</tr>
</tbody></table>
<ul>
<li>线程池中的Work内部类说明<br>java.util.concurrent.ThreadPoolExecutor.Worker本身是一个Runnable对象，并且内部有一个thread的成员变量，同时在初始化thread时把this当做参数传入thread中，当线程启动时就会调用Worker的run方法。run方法委托给runWorker方法，在内部会循环从初始任务或者任务队列中取出任务执行对应的run方法。（被提交到线程池的任务最终都会是runnable的实现类，submit的Callable参数会被封装为FutureTask）</li>
<li>线程池中的RejectHandler内部类说明</li>
</ul>
<table>
<thead>
<tr>
<th>拒绝策略</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>AbortPolicy</td>
<td>直接抛出RejectedExecutionException</td>
</tr>
<tr>
<td>CallerRunsPolicy</td>
<td>在调用execute方法的线程处理请求</td>
</tr>
<tr>
<td>DiscardPolicy</td>
<td>丢弃被拒绝的请求本身</td>
</tr>
<tr>
<td>DiscardOldestPolicy</td>
<td>丢弃最老的未处理的请求</td>
</tr>
</tbody></table>
<ul>
<li>线程池线程创建流程图</li>
</ul>
<p><img src="/images/thread-pool.svg"></p>
<ul>
<li>线程池的种类</li>
</ul>
<ol>
<li>普通的（ThreadPoolExecutor）<br>用来执行一次性的任务。</li>
<li>定时的（ScheduledThreadPoolExecutor)<br>用来执行需要定时执行的任务，包括<em>固定频率</em>和<em>固定延迟</em>两种任务。<br>实现原理：主要通过DelayedWorkQueue和ScheduledFutureTask来实现。<br>DelayedWorkQueue：获取taks时通过比较当前时间和delay的大小进行比较，只有delay小于等于当前时间才返回task（表示已经达到task的执行时间），否则会进行等待，等待时长为delay对应的时间。当队列中有新的任务增加时会进行唤醒。（因为存在后增加的任务比先增加的任务先执行的情况）。<br>ScheduledFutureTask：在run方法执行完后会重新新增一个任务，根据固定频率和固定延迟两种方式计算下次执行的时间点。固定评率下次的执行时间为<em>任务的执行时间+period</em>，固定延迟为<em>当前时间+period</em>。（内部实现通过period&gt;0表示固定频率任务，=0表示一次性任务，&lt;0表示固定延迟任务）</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/05/30/2020-05-30-Mybatis-%E4%B8%93%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mountain.jpg">
      <meta itemprop="name" content="wjainng">
      <meta itemprop="description" content="学而不思则罔思而不学则殆">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WJAINNG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/30/2020-05-30-Mybatis-%E4%B8%93%E9%A2%98/" class="post-title-link" itemprop="url">Mybatis-专题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-30 16:23:44" itemprop="dateCreated datePublished" datetime="2020-05-30T16:23:44+08:00">2020-05-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-16 23:15:44" itemprop="dateModified" datetime="2020-09-16T23:15:44+08:00">2020-09-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="xml文件解析的三种方式"><a href="#xml文件解析的三种方式" class="headerlink" title="xml文件解析的三种方式"></a>xml文件解析的三种方式</h4><h5 id="DOM方式："><a href="#DOM方式：" class="headerlink" title="DOM方式："></a>DOM方式：</h5><p>   把整个xml文件加载入内存并构建一个DOM树，基于这棵树形结构对各个节点进行操作。XML文档中的每个成分都是一个节点：有文档节点，元素节点，文本阶段，属性节点，注释节点等内容。</p>
<h5 id="SAX方式："><a href="#SAX方式：" class="headerlink" title="SAX方式："></a>SAX方式：</h5><p>   基于事件模型的方式解析XML，不需要将整个XMl文档加入内存中，只需要将一部分加载到内存即可，由SAX解析器解析到某个类型节点时，触发注册在该类型节点上的回调函数，一般通过继承DefaultHandler重写相关的回调方法即可<code>startDocument,startElement,characters,endElement,endDocument方法</code>。又称为推的模式，通过SAX解析器解析到对应的类型主动调用回调方法。（被动接受）</p>
<h5 id="StAX方式："><a href="#StAX方式：" class="headerlink" title="StAX方式："></a>StAX方式：</h5><p>   又称为拉的模式，解析器不会主动解析XMl由用户主动控制需要处理事件类型以及事件的调用。（主动接受）</p>
<h4 id="mybatis-一级缓存"><a href="#mybatis-一级缓存" class="headerlink" title="mybatis 一级缓存"></a>mybatis 一级缓存</h4><ul>
<li><p>开启或者关闭一级缓存</p>
<p>mybatis默认开启session级缓存，可以通过配置<code>&lt;settings&gt;&lt;setting name=&quot;localCacheScope&quot; value=&quot;STATEMENT&quot;/&gt;&lt;/settings&gt;</code>关闭。（默认值为SESSION也就开启一级缓存）</p>
</li>
<li><p>缓存的cachekey</p>
<p>缓存的cachekey由<code>statementId+offset+limit+sql+params</code>组成，当这五项一样时会认为是相同的sql，可以从缓存中获取数据。</p>
</li>
<li><p>缓存失效：</p>
<p>当同一个sqlsession执行insert，update，delete，commit方法时会清除缓存。（如果获取sqlsession时指定autocomit为true则不需要手动执行commit则缓存不会清除）</p>
<blockquote>
<p>其他的sqlsession进行数据新增，修改或者删除时不会导致当前sqlsession的缓存失效，也就是一级缓存的范围是sqlsession级别，会导致因为缓存而读到之前的数据。</p>
</blockquote>
</li>
<li><p>缓存的实现：</p>
<p>mybatis的默认实现为PerpetualCache通过维护一个hashmap实现。同时还提供了很多装饰者模式实现的cache，底层用的都是PerpetualCache，只是增加了一些其他功能，例如FifoCache，LruCache，BlockingCache，SoftCache，WeakCache等。</p>
</li>
</ul>
<h4 id="mybatis-二级缓存"><a href="#mybatis-二级缓存" class="headerlink" title="mybatis 二级缓存"></a>mybatis 二级缓存</h4><ul>
<li><p>二级缓存的开启：<br>通过在mybatis-config.xml中配置<code>&lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</code>开启二级缓存，同时在映射文件中配置<code>&lt;cache/&gt;</code>或者<code>&lt;cache-ref/&gt;</code>配置cache的相关内容，可以通过cache-ref配置多个MappedStatement使用同一个命名空间的cache。</p>
</li>
<li><p>二级缓存的实现：<br>mybatis开启二级缓存后则会使用CachingExecutor进行sql语句的执行，会先从二级缓存对应namespace查找对应的值(MappedStatement中配置的cache)，再从一级缓存查找，最后才会查数据库。内部都是通过PerpetualCache存储数据，数据是存在本地，并且二级缓存需要在commit之后才会生效。当有表关联的数据并且属于不同的命名空间时存在读取脏数据的情况（在命名空间A中保存了a和b表关联的结果，如果在命名空间B中更新了b表的数据在命名空间A还是获取到之前的旧内容），可以通过cache-ref使用相同的命名空间，但是会导致缓存失效的情况变多。CachingExecutor通过装饰器模式内部包装了SimpleExecutor并增加了二级缓存的内容。</p>
</li>
</ul>
<center><h6>二级缓存示意图</h6></center>

<p><img src="/images/mybatis-cache.svg"></p>
<h4 id="理解过程中梳理的图"><a href="#理解过程中梳理的图" class="headerlink" title="理解过程中梳理的图"></a>理解过程中梳理的图</h4><center><h6>SQL语句执行示意图</h6></center>

<p><img src="/images/mybatis-execute.svg"></p>
<blockquote>
<p>在上图中的核心部分，也就是Executor，StatementHandler，ParameterHandler，ResultSetHandler的处理过程中都可以编写相关的拦截器进行处理。</p>
</blockquote>
<center><h6>类之间的依赖关系（只包含主要的关系）</h6></center>

<p><img src="/images/mybatis-dependency.svg"></p>
<blockquote>
<p>ResultSetHandler中包含Executor是因为涉及到子查询和延迟加载的情况，需要重新通过Executor执行相关的命令。<br>  mybatis中的configuration是一个‘上帝类’从中可以获取Executor，StatementHandler，ParameterHandler，ResultSetHandler，并且在获取时都会调用interceptorChain.pluginAll调用拦截器进行处理。</p>
</blockquote>
<center><h6>open session对应的时序图</h6></center>

<p><img src="/images/mybatis-session.svg" alt="mybatis open session"></p>
<blockquote>
<p>configuration中存有environment对应有数据源相关的内容（对应mybatis-config.xml中配置的内容），同时有默认的executeType，通过传入从environment获取的datasource从transactionfactory获取transaction，根据transaction和executeType从configuration获取Executor，再通过Executor，configuration，autoCommit创建一个SqlSession。（Transaction的创建使用了工厂方法模式，由对应的TransactionFactory创建对应的Transaction）</p>
</blockquote>
</br>
<center><h6>执行insert时对应的时序图（以默认的实现为例）</h6></center>

<p><img src="/images/mybatis-insert.svg" alt="mybatis insert"></p>
<blockquote>
<p>对SqlSession的操作最终都会委托到Executor的update方法，Executor的update方法会清除缓存，准备好StatementHandler, StatementHandler调用ParameterHandler处理传入的参数，执行update方法，调用ResultSetHandler处理返回结果。SqlSession的commit方法通过委托给Executor最终通过Transaction执行提交。</p>
</blockquote>
<center><h6>SQL语句查询序列图</h6></center>

<p><img src="/images/mybatis-query.svg"></p>
<blockquote>
<p>上图描述的是二级和一级缓存都失败的执行情况</p>
</blockquote>
<center><h6>Mapper相关的类图</h6></center>

<p><img src="/images/mybatis-mapper-class.svg"></p>
<blockquote>
<p>MapperRegistry注册了所有Mapper类对应的MapperProxyFactory,通过MapperProxyFactory获取MapperProxy，MapperProxy为Mapper的代理类，Mapper中的Method在MapperProxy有一个对应的MapppedMethod与之相对应，通过MappedMethod的execute方法实现Mapper中Method的实际数据库的调用。MappedMethod中最终通过SqlSession进行数据库相关方法的调用。SqlCommand封装了需要执行的sql的类型以及对应的MappedStatement对应的id（类名+方法名），MethodSignature的主要作用为通过ParamNameResolver对传进来的参数进行解析。</p>
</blockquote>
<center><h6>获取mapper的时序图</h6></center>

<p><img src="/images/mybatis-mapper.svg"></p>
<h4 id="其他内容"><a href="#其他内容" class="headerlink" title="其他内容"></a>其他内容</h4><ul>
<li>#{}和\${}的区别<br>#{}会生成预编译的sql，会正确处理数据类型并且可以避免sql注入，\${}仅仅是文本替换。\${}一般用在order by，group by，limit等场景。</li>
<li>like拼接%有两种方式，一种是在参数中直接拼接，另一种是通过CONCAT(‘%’,CONCAT(#{query.strategyName,jdbcType=VARCHAR},’%’))拼接。</li>
</ul>
<h4 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h4><p><small>[1] Mybatis技术内幕</small></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/05/24/2020-05-24-Maven-%E4%B8%93%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mountain.jpg">
      <meta itemprop="name" content="wjainng">
      <meta itemprop="description" content="学而不思则罔思而不学则殆">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WJAINNG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/24/2020-05-24-Maven-%E4%B8%93%E9%A2%98/" class="post-title-link" itemprop="url">Maven-专题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-24 19:06:50" itemprop="dateCreated datePublished" datetime="2020-05-24T19:06:50+08:00">2020-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-16 23:15:44" itemprop="dateModified" datetime="2020-09-16T23:15:44+08:00">2020-09-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>maven是一个强大的构建工具，能够帮助我们进行自动化构建，从清理、编译、测试到生成报告，再到打包和部署。</p>
<h3 id="maven配置"><a href="#maven配置" class="headerlink" title="maven配置"></a>maven配置</h3><p>maven在安装路径的conf目录下有一个settings.xml文件，该文件可以配置全局的信息，对该电脑上的所有用户都生效。一般建议拷贝一个settings.xml文件到<del>/.m2/下只在用户范围配置信息。（</del>指用户的当前目录下）</p>
<h3 id="maven坐标"><a href="#maven坐标" class="headerlink" title="maven坐标"></a>maven坐标</h3><p>maven通过坐标唯一确定其依赖。</p>
<table>
<thead>
<tr>
<th>值</th>
<th>是否必填</th>
<th>默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>groupId</td>
<td>是</td>
<td>-</td>
<td>一般用公司域名加项目的名字</td>
</tr>
<tr>
<td>artifactId</td>
<td>是</td>
<td>-</td>
<td>项目名字加maven模块名</td>
</tr>
<tr>
<td>version</td>
<td>是</td>
<td>-</td>
<td>版本号</td>
</tr>
<tr>
<td>packaging</td>
<td>否</td>
<td>jar</td>
<td>打包形式</td>
</tr>
<tr>
<td>classifier</td>
<td>否</td>
<td>-</td>
<td>附属构建例如源代码，文档等需要通过插件生成</td>
</tr>
</tbody></table>
<h3 id="mavn依赖范围关系"><a href="#mavn依赖范围关系" class="headerlink" title="mavn依赖范围关系"></a>mavn依赖范围关系</h3><table>
<thead>
<tr>
<th>类型</th>
<th>编译classpath</th>
<th>测试classpath</th>
<th>运行classpath</th>
<th>样例</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>compile</td>
<td>有效</td>
<td>有效</td>
<td>有效</td>
<td>spring-core</td>
<td></td>
</tr>
<tr>
<td>test</td>
<td>无效</td>
<td>有效</td>
<td>无效</td>
<td>junit</td>
<td>只有测试时需要，其他情况都不需要</td>
</tr>
<tr>
<td>runtime</td>
<td>无效</td>
<td>有效</td>
<td>有效</td>
<td>数据库驱动</td>
<td>因为测试也相当于是要运行的</td>
</tr>
<tr>
<td>provided</td>
<td>有效</td>
<td>有效</td>
<td>无效</td>
<td>servlet-api</td>
<td>容器提供，只有运行时不需要</td>
</tr>
<tr>
<td>system</td>
<td>有效</td>
<td>有效</td>
<td>无效</td>
<td>本地jar例如oracle驱动</td>
<td>与provided一样，依赖构建的环境，可能导致构建不可移植</td>
</tr>
<tr>
<td>import</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>与依赖管理一起使用</td>
</tr>
</tbody></table>
<p><font color=HotPink><em>注意：运行classpath无效时，打包时不会包含对应的jar包</em></font></p>
<p>传递性依赖和依赖范围<br>假设A依赖B，B依赖C则A对C的依赖为传递性依赖。</p>
<table>
<thead>
<tr>
<th>第一依赖/第二依赖</th>
<th>compile</th>
<th>test</th>
<th>provided</th>
<th>runtime</th>
</tr>
</thead>
<tbody><tr>
<td>compile</td>
<td>compile</td>
<td>-</td>
<td>-</td>
<td>runtime</td>
</tr>
<tr>
<td>test</td>
<td>test</td>
<td>-</td>
<td>-</td>
<td>test</td>
</tr>
<tr>
<td>provided</td>
<td>provided</td>
<td>-</td>
<td>provided</td>
<td>provided</td>
</tr>
<tr>
<td>runtime</td>
<td>runtime</td>
<td>-</td>
<td>-</td>
<td>runtime</td>
</tr>
</tbody></table>
<blockquote>
<p>如果第二依赖为compile则传递性的依赖等同于第一依赖。当第二依赖为test时依赖不会传递。当第二依赖为provided时只有第一依赖也为provided时起作用。当第二依赖为runtime时与第一依赖一致除了compile（还是为runtime）</p>
</blockquote>
<p>可选依赖：</p>
<p>可选依赖通过&lt;option&gt;true&lt;/option&gt;实现，可选依赖不会传递，假如A依赖B，B依赖C和D并且定义为&lt;option&gt;true&lt;/option&gt;则A不会依赖C和D。如果需要使用C或者D需要在A中重新定义。例如一个持久化层包B依赖mysql或者pg的驱动包，但是实际只会使用其中的一个，则由A来确定使用哪一个。但是B在编译时必须依赖C和D。</p>
<p>依赖的排除：</p>
<p>依赖的排除&lt;exclusions&gt;&lt;execlusion&gt;&lt;groupId&gt;groupId&lt;/groupId&gt;&lt;artifactId&gt;artifactId&lt;/artifactId&gt;&lt;/execlusion&gt;&lt;/exclusions&gt;</p>
<blockquote>
<p>依赖关系优先级，路径最短的优先，非同一个文件中的优先定义的高，同一个文件中定义的则后定义的高。例如在pom文件中依赖了A和B，A和B都依赖C，则C以A中定义的优先，但是在pom文件中先后依赖了A的1.0和A的1.1版本，则以1.1版本为准。</p>
</blockquote>
<h3 id="maven常用命令"><a href="#maven常用命令" class="headerlink" title="maven常用命令"></a>maven常用命令</h3><p>mvn clean //清理<br>mvn compile //编译<br>mvn test //运行测试<br>mvn site //生成sit<br>mvn package //打包<br>mvn install //部署到本地仓库<br>mvn deploye //部署到远程仓库，需要配置distributionManagement<br>mvn clean install -U//-U指定强制更新，对快照版本有效<br>mvn source:jar //对源码进行打包<br>mvn help:system 打印所有java系统属性和环境变量</p>
<blockquote>
<p>mvn插件的执行格式为：mvn groupId:artifactId:version:goal（groupId和version可以省略，artifactId可以用前缀替换，例如maven官方的插件默认都是maven-***-plugin）<br>mvn执行命令时可以通过命令行传递参数例如，-Dmaven.test.skip=true调过测试代码的编译和的执行， -DskipTests只会调过测试代码的执行。</p>
</blockquote>
<h3 id="maven常用配置元素说明"><a href="#maven常用配置元素说明" class="headerlink" title="maven常用配置元素说明"></a>maven常用配置元素说明</h3><p>mirror 可以用来镜像对仓库的引用，例如配置一个阿里的镜像来加快依赖包的下载。<br>repository 用来定义不同的仓库，可以设置是否允许快照版本，以及更新频率，快照默认为1天更新一次。可以通增加-U强制刷新,例如mvn clean install -U。<br>servers 用来配置用户名和密码，配置代理，访问远程仓库，上传jar包到私服时可能需要登录信息。<br>proxy 用来设置代理，例如有些公司外网需要通过代理进行访问。<br>dependency 用来配置依赖。<br>dependencyManagement 用来配置依赖管理，主要是管理版本信息。<br>distributionManagement 用来配置上传jar包对应的repository。可以通过在pom或者setting.xml中的profile中定义。</p>
<pre><code>用于部署本地jar包到私服，一般需要同时在server下配置id对应的用户名密码。distributionManagement可以在pom文件中定义，和profile中定义
&lt;distributionManagement&gt;
  &lt;repository&gt;
    &lt;id&gt;release&lt;/id&gt;
  &lt;name&gt;release repository&lt;name&gt;
  &lt;url&gt;ip:port/nexus/content/repositories/releases&lt;/url&gt;
  &lt;/repository&gt;
  &lt;repository&gt;
    &lt;id&gt;snapshorts&lt;/id&gt;
    &lt;name&gt;snapshorts repository&lt;name&gt;
    &lt;url&gt;ip:port/nexus/content/repositories/snapshorts&lt;/url&gt;
  &lt;/repository&gt;
&lt;/distributionManagement&gt;
servers只能在setting.xml文件中配置
&lt;servers&gt;
  &lt;server&gt;
    &lt;id&gt;releases&lt;/id&gt;
    &lt;username&gt;admin&lt;/username&gt;
    &lt;password&gt;*****&lt;/password&gt;
  &lt;/server&gt;
&lt;/servers&gt;</code></pre>
<h3 id="生命周期和绑定"><a href="#生命周期和绑定" class="headerlink" title="生命周期和绑定"></a>生命周期和绑定</h3><p>maven一共有三个生命周期，每个生命周期又包括不同的阶段，通过将插件绑定到不同生命周期的不同阶段实现不同的目标，同一个生命周期的同一个阶段如果有多个插件绑定则执行顺序由声明的顺序决定。</p>
<ol>
<li>clean生命周期</li>
<li>default生命周期</li>
<li>sit生命周期</li>
</ol>
<p>生命周期之间没有先后顺序，同一个生命周期的不同阶段是有先后顺序的，执行后面的阶段会导致之前的阶段都会执行。（生命周期的阶段类似于模板方法）</p>
<h3 id="maven插件"><a href="#maven插件" class="headerlink" title="maven插件"></a>maven插件</h3><h4 id="插件的解析"><a href="#插件的解析" class="headerlink" title="插件的解析"></a>插件的解析</h4><p>官方插件的默认groupId为org.apache.maven.plugins可以省略，同时前缀和artifactId可以通过settings.xml文件配置自定义的内容，这样可以通过前缀匹配到artifactId，版本号通过最新的或者超级POM中配置的版本号获取。</p>
<p>org/apache/maven/plugins/artifactId/maven-metadata.xml定义了插件的版本信息<br>org/apache/maven/plugins/maven-metadata.xml中检查前缀对应的artifactId。<br> <pluginGroups><br>  <pluginGroup>com.your.plugins</pluginGroup><br> </pluginGroups><br>还会检查com/your/plugins/maven-metadata.xml中的内容</p>
<blockquote>
<p>mvn dependency:tree 可以打印依赖树，mvn dependency:analyze可以对依赖包进行分析，会输出哪些有引用但是没有依赖的以及依赖但是没有使用的包。ide中可以通过show effective pom生成最终生效的pom文件，和查看包的依赖关系图。</p>
</blockquote>
<h4 id="插件的实现"><a href="#插件的实现" class="headerlink" title="插件的实现"></a>插件的实现</h4><p>通过继承org.apache.maven.plugin.AbstractMojo实现，同时插件对应的打包方式必须为maven-plugin，插件需要指定goal和绑定阶段。</p>
<h3 id="聚合和继承"><a href="#聚合和继承" class="headerlink" title="聚合和继承"></a>聚合和继承</h3><p>聚合：当需要把多个模块聚合在一起时使用。<br>继承：子模块会继承父模块的属性，例如依赖，groupId，artifactId等。</p>
<p>聚合和继承POM中的packaging必须是pom，一般项目的根同时是聚合POM和父POM。</p>
<blockquote>
<p>dependencyManagement声明依赖但是不会引入依赖，一般用来定义版本号，用来保证同一个项目中的不同模块都使用同一个版本的jar包。dependencyManagement中可以声明import的scope用来引用其他文件的dependencyManagement声明的内容。</p>
</blockquote>
<h3 id="maven内置变量及profile"><a href="#maven内置变量及profile" class="headerlink" title="maven内置变量及profile"></a>maven内置变量及profile</h3><p>内置属性：${basedir}, ${version}<br>POM属性：${project.artifactId}, ${project.build.sourceDirectory}等<br>自定义属性：在POM中定义的properties属性。<br>Settings属性：${settings.localRepository}<br>Java系统属性：${user.home}可以通过mvn help:system查看<br>环境变量属性：${env.JAVA_HOME}</p>
<h3 id="nexus-说明"><a href="#nexus-说明" class="headerlink" title="nexus 说明"></a>nexus 说明</h3><p>maven中分本地仓库和远程仓库，远程仓库再分中央仓库，私服，其他远程仓库。默认先从本地仓库找，只有在本地仓库找不到才从远程仓库找。</p>
<p>nexus中内置的仓库</p>
<ol>
<li>Maven Central：代理Maven的中央仓库，只会下载和缓存中央仓库的release版本。</li>
<li>Releases：release版本的宿主类型仓库，用来部署组织内的发布版本。</li>
<li>Snapshots：snapshot的宿主类型仓库，用来部署组织内的快照版本。</li>
<li>3rd party：release版本的宿主类型仓库，用来部署无法从公共仓库获得的第三方发布版本。</li>
<li>Public Repositories：将所有的release仓库聚合并通过一致的地址提供服务。</li>
<li>Public Snapshot Repositories：将所有的snapshot仓库聚合并通过一致的地址提供服务。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/05/21/2020-05-21-GIT-%E4%B8%93%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mountain.jpg">
      <meta itemprop="name" content="wjainng">
      <meta itemprop="description" content="学而不思则罔思而不学则殆">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WJAINNG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/21/2020-05-21-GIT-%E4%B8%93%E9%A2%98/" class="post-title-link" itemprop="url">GIT-专题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-21 23:27:07" itemprop="dateCreated datePublished" datetime="2020-05-21T23:27:07+08:00">2020-05-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-16 23:15:44" itemprop="dateModified" datetime="2020-09-16T23:15:44+08:00">2020-09-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Git是一个开源的分布式版本控制系统。</p>
<h2 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h2><pre><code>git init &lt;directory&gt; 当前目录初始化git本地仓库
git clone &lt;remote_url&gt; 基于远程仓库克隆至本地

git add -A|&lt;fileName&gt;|&lt;directory&gt; 增加所有/文件/目录到暂存区

git rm --cached target -r 将指定的target移除暂存区

git commit -am remark 将所有文件提交，remark为描述
git commit file -m remark 将file提交，remark为描述

git reset --mixed|soft|hard HEAD~[1,2,3] 撤回commit到前一个，前2个提交.
git checkout -- filename 会撤销对filename的修改，直接用最新的版本替换
git commit --amend 只想更改注释时使用

git branch -avv 查看当前分支
git branch &lt;branch name&gt; 基于当前分支创建新的分支
git branch &lt;branch name&gt; &lt;commit id&gt; 基于提交创建分支
git branch -d &lt;branch name&gt; 删除分支
git branch &lt;new branch name&gt; &lt;base branch name&gt; 基于base创建new
git checkout &lt;branch name&gt; 切换到branch name
git checkout -b bf origin/serverfix 基于远程serverfix创建bf分支并切换到bf分支
git checkout --track origin/serverfix 类似上面的命令只是新建的分支也是serverfix
git merge &lt;target&gt; 将target分支合并到当前分支

git remote -v 查看远程分支
git remote add origin &lt;remote url&gt; 增加远程地址
git remote remove origin 删除远程地址
git push -u origin master 上传分支到远程(--set-upstream-to)第一次需要使用这种方式
git push -u origin localbranch:remobebranch 当本地和远程的分支名不一样时使用local:remote的形式 
git push origin/master:
git branch -u origin/master master 把本地分支master关联到远程分支origin/master
git push origin --delete branch 删除远程branch分支

git pull 想当于git fetch + git merge 从远程拉取数据并合并到当前分支

git tag 查看tag
git tag tagName 根据当前分支创建tag
git tag tagName branchName 根据branchName创建tagName
git tag -d tagName 删除tagName

git log 查看当前分支log
git log branchName 查看branchName分支log
git log --oneline 单行显示日志
git log branch1..branch2 比较两个分支的差异(显示branch2比branch1多的内容)
git diff branch1 branch2 fileName 比较两个分支对应fileName的差异
git log --pretty=format:&#39;%h %s&#39; --graph 以图表形式显示提交网络

git stash 会储藏工作目录的脏的状态，然后工作区会回到之前的状态，可以进行分支切换。（后续可以重新应用这些改动）
git stash list 可以查看所有的暂存信息
git stash apply [stashname] 可以重新应用暂存的内容
git stash drop [stashname] 删除暂存内容
git stash pop 应用暂存内容然后从栈上扔掉它

git --help 查看git的命令详情
git help commit 查看commit命令的详情(git commit --help, man git-commit)这三个命令是一样的效果
git config --list 查看配置信息</code></pre>
<blockquote>
<p>说明：git reset 默认为mixed：<strong>不删除</strong>工作空间改动代码，<strong>撤销</strong>commit和add操作。soft：<strong>不删除</strong>工作空间改动代码，<strong>撤销</strong>commit，<strong>不撤销</strong>add操作。hard：<strong>删除</strong>工作空间改动代码，<strong>撤销</strong>commit和add操作。<br><br>大部分命令默认是第二个参数是当前分支，除非指定第二个参数。<br><br>git init –bare 用来创建裸仓库，会直接把.git目录下的内容显示出来（裸仓库不包含工作区因此不能执行git相关的命令）一般远程仓库建议用裸仓库，这样就不能在远程直接修改文件了，减少冲突的几率。</p>
</blockquote>
<h2 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h2><ol>
<li><p>GIT提交对象</p>
<p>每一次提交为当前版本的一个快照，存储的内容为：一个顶级的树对象，上一次提交的对象hash，提交者的用户名，邮箱，提交时间以及评论。</p>
</li>
<li><p>GIT树对象</p>
<p>包含多个文件名称与其对应的hash，以及其他树对象的引用。类似于文件系统的文件夹。</p>
</li>
<li><p>GIT存储对象</p>
<p>存储实际的文件内容</p>
</li>
<li><p>GIT引用</p>
<p>当执行git branch branchName创建分支时，就是基于当前分支最新的提交创建一个应用文件，保存在.git/refs/heads下(存在分支引用，远程分支引用，标签引用三种类型)</p>
</li>
</ol>
<p><img src="/images/git_three_tree.svg" alt="git中的三棵树"></p>
<p>通过这三颗树可以很好的理解reset和checkout命令的影响</p>
<table>
<thead>
<tr>
<th>&nbsp;</th>
<th>HEAD</th>
<th>索引</th>
<th>工作区间</th>
<th>工作区间是否安全</th>
</tr>
</thead>
<tbody><tr>
<td>commit级别</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>reset –soft [commit]</td>
<td>REF</td>
<td>否</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>reset [commit]</td>
<td>REF</td>
<td>是</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>reset –hard [commit]</td>
<td>REF</td>
<td>是</td>
<td>是</td>
<td><font color=red><strong>否</strong></font></td>
</tr>
<tr>
<td>checkout [commit]</td>
<td>HEAD</td>
<td>是</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>文件级别</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>reset (commit) [file]</td>
<td>否</td>
<td>是</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>checkout (commit) [file]</td>
<td>否</td>
<td>是</td>
<td>是</td>
<td><font color=red><strong>否</strong></font></td>
</tr>
</tbody></table>
<p><em>reset和checkout的区别之一是reset会更改分支的指向，而checkout只会更改head的指向</em></p>
<blockquote>
<p>git cat-file -p hash 可以查看对应hash文件中的内容。<br>git hash-object -w fileName 相当于git add fileName把文件写入。<br>每次修改文件后提交，至少会新增一个commit对象，一个树对象，一个文件对象。<br>(find .git/objects -type f 查看所有的文件)<br>git ls-tree -r HEAD 查看最新版本的内容<br>git ls-files -s 查看add但是没有commit的内容</p>
</blockquote>
<h2 id="GIT支持的协议"><a href="#GIT支持的协议" class="headerlink" title="GIT支持的协议"></a>GIT支持的协议</h2><ol>
<li><p>Local（本地协议）</p>
<p>基于文件系统共享，只能在局域网使用，速度慢。使用文件系统对应的权限。</p>
</li>
<li><p>ssh</p>
<p>搭建简单，通过ssh访问是安全的，权限体系不灵活，必须提供操作系统账号密码，无法创建只读权限。</p>
</li>
<li><p>http</p>
<p>依赖于web容器，搭建复杂一些。又分为智能http和哑http协议（其中哑协议是只读的，相对于提供一个静态文件服务）。</p>
</li>
<li><p>git</p>
<p>无授权机制，需要开启一个新的守护进程，传输速度最快。</p>
</li>
</ol>
<h2 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h2><p>下图是一个典型的分支管理方式，master保存最新的代码，功能在feture分支开发，开发完后提交到master，有master创建release分支进行集成测试及发布，最终合并到master和打发布的标签。<br><img src="/images/git-branch.svg" alt="git 分支管理"></p>
<p>git merge source（合并source到当前分支）为了提交树更容易看懂，可以通过rebase进行合并，前提是source分支没有提交到远程，否则会引发其他麻烦。</p>
<p>git rebase master （当前分支dev基于master分支进行rebase）<br>git checkout master 切换到master分支<br>git merge dev 合并dev到master分支，会进行fast forward，提交树会变成一条直线。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/12/22/2019-12-22-Spring-MVC-%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mountain.jpg">
      <meta itemprop="name" content="wjainng">
      <meta itemprop="description" content="学而不思则罔思而不学则殆">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WJAINNG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/22/2019-12-22-Spring-MVC-%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">Spring MVC 笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-22 16:00:32" itemprop="dateCreated datePublished" datetime="2019-12-22T16:00:32+08:00">2019-12-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-16 23:15:44" itemprop="dateModified" datetime="2020-09-16T23:15:44+08:00">2020-09-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>DispatcherServlet</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wjainng"
      src="/images/mountain.jpg">
  <p class="site-author-name" itemprop="name">wjainng</p>
  <div class="site-description" itemprop="description">学而不思则罔思而不学则殆</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">59</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wjainng</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
